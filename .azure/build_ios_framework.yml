pool:
  name: MobileTeamPool
  demands: isSupportsIOS -equals true

schedules:
- cron: "*/5 * * * *"
  displayName: 'Every 5 minutes check new tags'
  branches:
    exclude:
    - '*'
  tags:
    include:
    - '*'

steps:
  - script: |
      cd ios_framework
      ./build_ios_framework.sh --source-dir=$(Build.SourcesDirectory) --output-dir="$PWD/artifact" --name="PJSIP-iOS-$(Build.SourceBranchName)"
    displayName: 'Build framework'

  - task: CopyFiles@2
    displayName: 'Copy Files to build directory'
    inputs:
      SourceFolder: './ios_framework/artifact'
      TargetFolder: '$(Build.ArtifactStagingDirectory)'

  - task: GitHubRelease@1
    displayName: 'Create GitHub release'
    inputs:
      gitHubConnection: 'PJSIP iOS Test'
      title: 'PJSIP iOS $(Build.SourceBranchName)'
      isDraft: true
      addChangeLog: false